# OpenClaw First Light ‚Äî Issue-Driven Command Execution

> **üî≠ First Light** is the milestone where the `.GITOPENCLAW` agent pipeline can securely process GitHub Issues end-to-end: settings are validated, user trust levels are enforced, cost/resource boundaries are in place, and every OpenClaw CLI command is available through Issue comments.

This document describes in detail how GitHub Issues serve as the primary interface for executing OpenClaw commands ‚Äî from creating an issue to receiving a structured reply.

---

## How It Works

1. A user **creates a GitHub Issue** or **comments on an existing Issue** in a repository that has `.GITOPENCLAW/` installed.
2. The `GITOPENCLAW-WORKFLOW-AGENT.yml` GitHub Actions workflow triggers on `issues.opened` and `issue_comment.created` events.
3. The workflow runs a security pipeline:
   - **Authorize** ‚Äî checks the actor's repository permission level (`admin`, `maintain`, `write`, or lower).
   - **Guard** ‚Äî verifies the `GITOPENCLAW-ENABLED.md` sentinel file exists (fail-closed).
   - **Preflight** ‚Äî validates `config/settings.json` against its JSON Schema, checks all required lifecycle files exist, and verifies secrets are not accidentally committed.
4. The **command parser** (`command-parser.ts`) examines the Issue body or comment text:
   - If the first line starts with `/` (e.g., `/status`, `/config set provider openai`), it is parsed as a **slash command** with a command name and arguments.
   - If no `/` prefix is detected, the full text is treated as **natural language input** for the OpenClaw agent (the default conversational mode).
5. **Trust gating** is applied based on `config/settings.json` ‚Üí `trustPolicy`:
   - **Trusted users** (listed by GitHub username) ‚Üí full access to all commands.
   - **Semi-trusted roles** (e.g., collaborators with `write` permission) ‚Üí read-only commands only; mutation commands are blocked.
   - **Untrusted users** ‚Üí receive a read-only explanation or are blocked entirely.
6. The orchestrator (`GITOPENCLAW-AGENT.ts`) builds and executes the appropriate `openclaw` CLI invocation on the GitHub Actions runner.
7. The agent's reply is **posted as an Issue comment** ‚Äî formatted with rich Markdown (tables, collapsible sections, emoji status indicators).
8. All state changes (session transcripts, issue mappings, usage logs) are **committed to git** inside `.GITOPENCLAW/state/` and pushed back to the default branch.
9. The üëÄ reaction indicator (added at the start) is removed, signalling completion.

---

## The Two Interaction Modes

### Mode 1: Natural Language (Default)

Any Issue body or comment that does not start with `/` is forwarded to the OpenClaw agent as a conversational message. The agent has access to 30+ tools, semantic memory, the full repository as workspace context, and multi-turn conversation history.

**Example ‚Äî Creating an Issue:**

```
Title: How do I add Slack integration?
Body:  I want to connect my agent to Slack so it can respond to messages there.
```

The agent reads the issue, thinks, and replies with a detailed answer as a comment. On the next comment, the agent resumes the conversation with full context from the session transcript stored in `.GITOPENCLAW/state/sessions/`.

### Mode 2: Slash Commands (Structured)

Commenting with a `/command` prefix triggers a specific OpenClaw CLI command. The command parser extracts the command name and arguments into a structured object: `{ command, args, rawText }`. The orchestrator then maps this to the equivalent `openclaw <command> <args>` CLI invocation.

**Example ‚Äî Commenting on an Issue:**

```
/config set provider openai
```

The agent replies:

```
‚úÖ Configuration updated:
| Setting  | Previous  | New    |
|----------|-----------|--------|
| provider | anthropic | openai |

Changes committed to `config/settings.json`.
```

---

## Complete Slash Command Reference

Every slash command maps to a real `openclaw` CLI subcommand. Commands are grouped by category below.

### Agent

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/agent` | Run one agent turn via the gateway | No | `/agent summarize the last 5 PRs` |
| `/agents` | Manage isolated agents | No | `/agents list` |

**How it works:** `/agent <message>` invokes `openclaw agent --message "<message>" --local --json`. The structured JSON output is parsed, the assistant's final text reply is extracted, and it is posted as an Issue comment. Session continuity is maintained via the issue-to-session mapping in `.GITOPENCLAW/state/issues/<number>.json`.

### Configuration

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/setup` | Initialize local config and agent workspace | üîí Yes | `/setup` |
| `/onboard` | Interactive onboarding wizard | üîí Yes | `/onboard` |
| `/configure` | Interactive setup wizard for credentials/channels/gateway | üîí Yes | `/configure` |
| `/config` | Non-interactive config helpers | üîí Yes | `/config set provider openai` |
| `/reset` | Reset local config/state | üîí Yes | `/reset` |
| `/uninstall` | Uninstall gateway service and local data | üîí Yes | `/uninstall` |

**How it works:** `/config set <key> <value>` invokes `openclaw config set <key> <value>`. Before execution, the trust gate verifies the actor is a trusted user (mutation commands are blocked for semi-trusted and untrusted users). The result is rendered as a config diff table showing previous and new values.

**Onboarding example (multi-turn):** Commenting `/onboard` starts a guided wizard. The agent posts the first step ("Choose your LLM provider"), the user replies in a follow-up comment, the workflow triggers again, the agent detects the in-progress onboarding session, and advances to the next step. This continues until configuration is complete.

### Health & Status

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/doctor` | Run health checks and quick fixes | No | `/doctor` |
| `/status` | Show channel health and agent status | No | `/status` |
| `/health` | Fetch health from running gateway | No | `/health` |

**How it works:** `/status` invokes `openclaw status` and renders the output as a rich Markdown dashboard:

```markdown
## üêæ OpenClaw Agent Status

| Component     | Status     | Details                                  |
|---------------|------------|------------------------------------------|
| Agent Runtime | ‚úÖ Active  | v2026.2.19, Anthropic claude-opus-4-6    |
| Memory        | ‚úÖ 1,247   | Last search: 2m ago                      |
| Sessions      | ‚úÖ 23      | Oldest: 14d                              |
| Cron          | ‚úÖ 2 tasks | Next run: Mon 09:00 UTC                  |
| Plugins       | ‚úÖ 3       | memory-lancedb, slack, discord           |
```

### Channels

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/channels` | Manage connected chat channels | No | `/channels status` |

**How it works:** `/channels status` invokes `openclaw channels status` and renders a table of channel names, types, and connection status with emoji indicators (‚úÖ connected, ‚ö†Ô∏è degraded, ‚ùå disconnected).

### Sessions

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/sessions` | List stored conversation sessions | No | `/sessions list` |

**How it works:** `/sessions list` invokes `openclaw sessions list` and renders a table of session IDs, associated issue numbers, turn counts, and last activity timestamps. Sessions are stored as JSONL transcripts in `.GITOPENCLAW/state/sessions/` and are committed to git for full auditability.

### Memory

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/memory` | Search and reindex memory files | No | `/memory search deployment process` |

**How it works:** `/memory search <query>` invokes `openclaw memory search <query>`. Results are posted as a comment with matched entries, relevance scores, and source references. Memory entries are stored in `.GITOPENCLAW/state/memory.log` (append-only, with `merge=union` git attribute to reduce merge conflicts).

### Models

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/models` | Discover, scan, and configure models | No | `/models list` |

**How it works:** `/models list` invokes `openclaw models list` and renders available models grouped by provider (Anthropic, OpenAI, Google, etc.) in a Markdown table with model names, capabilities, and pricing tiers.

### Messages

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/message` | Send, read, and manage messages | üîí Yes | `/message send --to slack #general "Hello"` |

**How it works:** `/message send --to <channel> <text>` invokes the outbound delivery tool via `openclaw message send`. This allows the Issue-based agent to push messages to external channels (Slack, Discord, Telegram, etc.) using credentials stored in GitHub Actions secrets.

### Cron

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/cron` | Manage cron jobs via Gateway scheduler | üîí Yes | `/cron create --schedule "0 9 * * MON" --message "Weekly summary"` |

**How it works:** `/cron create` registers a scheduled task. Cron tasks run via GitHub Actions `schedule` triggers or the gateway scheduler. `/cron list` shows all registered tasks with their schedules and last execution times.

### Plugins

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/plugins` | Manage OpenClaw plugins and extensions | üîí Yes | `/plugins install @openclaw/memory-lancedb` |

**How it works:** `/plugins install <name>` invokes `openclaw plugins install <name>`. Plugin state is managed within `.GITOPENCLAW/` and committed to git. Available plugins can be listed with `/plugins list`.

### Skills

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/skills` | List and inspect available skills | No | `/skills list` |

**How it works:** `/skills list` invokes `openclaw skills list` and posts a formatted list of all skills available to the agent, with descriptions and activation status.

### Update

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/update` | Update OpenClaw and inspect update channel status | üîí Yes | `/update` |

**How it works:** `/update` invokes `openclaw update` to check for and apply updates to the OpenClaw runtime. The result is posted as a comment showing the previous version, new version, and any changelog highlights.

### Help

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/help` | Show available commands and usage | No | `/help` |

**How it works:** `/help` does **not** invoke the OpenClaw agent. Instead, it reads the `SUPPORTED_COMMANDS` list from the command parser and posts a formatted reference of all available commands grouped by category, with argument syntax and examples. Commands requiring trusted access are marked with üîí.

### Additional Sub-CLIs

| Command | Description | Mutation | Example |
|---------|-------------|----------|---------|
| `/logs` | Tail gateway file logs via RPC | No | `/logs` |
| `/system` | System events, heartbeat, and presence | No | `/system` |
| `/approvals` | Manage exec approvals | No | `/approvals list` |
| `/nodes` | Manage gateway-owned node pairing | No | `/nodes list` |
| `/devices` | Device pairing and token management | No | `/devices list` |
| `/dns` | DNS helpers for wide-area discovery | No | `/dns lookup` |
| `/docs` | Search the live OpenClaw docs | No | `/docs search memory` |
| `/directory` | Lookup contact and group IDs | No | `/directory search` |
| `/security` | Security tools and local config audits | No | `/security audit` |
| `/secrets` | Secrets runtime reload controls | No | `/secrets reload` |
| `/completion` | Generate shell completion script | No | `/completion` |
| `/dashboard` | Open the Control UI | No | `/dashboard` |
| `/browser` | Manage OpenClaw's dedicated browser | No | `/browser status` |
| `/gateway` | Run, inspect, and query WebSocket Gateway | üîí Yes | `/gateway status` |
| `/sandbox` | Manage sandbox containers | üîí Yes | `/sandbox list` |
| `/hooks` | Manage internal agent hooks | üîí Yes | `/hooks list` |
| `/webhooks` | Webhook helpers and integrations | üîí Yes | `/webhooks list` |
| `/pairing` | Secure DM pairing | üîí Yes | `/pairing start` |

---

## End-to-End Example: First Light in Action

Here is a complete walkthrough of an Issue-driven command execution from start to finish.

### Step 1 ‚Äî User Creates an Issue

A repository collaborator creates a new Issue:

```
Title: Check agent status
Body:  /status
```

### Step 2 ‚Äî Workflow Triggers

GitHub fires an `issues.opened` event. The `GITOPENCLAW-WORKFLOW-AGENT.yml` workflow starts on an `ubuntu-latest` runner.

### Step 3 ‚Äî Security Pipeline

1. **Authorize**: The workflow checks `github.actor`'s permission via `gh api repos/{owner}/{repo}/collaborators/{actor}/permission`. Output: `"write"`.
2. **Guard**: `GITOPENCLAW-ENABLED.ts` verifies the sentinel file exists at `.GITOPENCLAW/GITOPENCLAW-ENABLED.md`.
3. **Preflight**: `GITOPENCLAW-PREFLIGHT.ts` validates `config/settings.json` against `settings.schema.json`, confirms all lifecycle scripts exist, and checks `.gitignore` rules.
4. **Indicator**: `GITOPENCLAW-INDICATOR.ts` adds a üëÄ reaction to the Issue to signal processing has started.

### Step 4 ‚Äî Command Parsing

`GITOPENCLAW-AGENT.ts` reads the Issue body: `/status`.

The command parser detects the `/` prefix and returns:

```json
{
  "command": "status",
  "args": [],
  "rawText": "/status"
}
```

### Step 5 ‚Äî Trust Gating

The orchestrator resolves the actor's trust level:
- Actor: `octocat` with permission `write`.
- `write` is in `semiTrustedRoles` ‚Üí trust level: **semi-trusted**.
- `/status` is a read-only command (`mutation: false`) ‚Üí **allowed**.

(If the user had commented `/config set provider openai`, this would be blocked because `config` is a mutation command and the actor is only semi-trusted.)

### Step 6 ‚Äî CLI Execution

The orchestrator builds and runs:

```bash
openclaw status --local --json
```

The `--local` flag runs the agent embedded (no gateway needed). The `--json` flag produces structured output for parsing.

### Step 7 ‚Äî Response Formatting

The output template renderer converts the structured status data into a rich Markdown comment:

```markdown
## üêæ OpenClaw Agent Status

| Component     | Status     | Details                                  |
|---------------|------------|------------------------------------------|
| Agent Runtime | ‚úÖ Active  | v2026.2.19, Anthropic claude-opus-4-6    |
| Memory        | ‚úÖ 1,247   | Last search: 2m ago                      |
| Sessions      | ‚úÖ 23      | Oldest: 14d                              |
| Cron          | ‚úÖ 2 tasks | Next run: Mon 09:00 UTC                  |
| Plugins       | ‚úÖ 3       | memory-lancedb, slack, discord           |
```

### Step 8 ‚Äî State Persistence

The orchestrator:
1. Writes a usage log entry to `.GITOPENCLAW/state/usage.log` (timestamp, issue number, actor, tokens used, duration).
2. Stages all changed files under `.GITOPENCLAW/`.
3. Commits with message: `gitopenclaw: agent reply on issue #42`.
4. Pushes to the default branch (with up to 3 retry attempts on conflict, using `git pull --rebase`).

### Step 9 ‚Äî Comment Posted

The reply is posted as a comment on Issue #42 via `gh api repos/{owner}/{repo}/issues/42/comments`.

### Step 10 ‚Äî Cleanup

The üëÄ reaction is removed from the Issue, signalling that processing is complete. This happens in a `finally` block to guarantee cleanup even if an error occurred.

---

## Session Continuity Across Turns

Each Issue maintains a persistent conversation session:

- **New issue** ‚Üí a fresh session is created; the mapping is recorded in `.GITOPENCLAW/state/issues/<number>.json`.
- **Follow-up comment** ‚Üí the existing session transcript is loaded from `.GITOPENCLAW/state/sessions/<id>.jsonl`, giving the agent full conversation context.

The copy-archive-restore cycle ensures multi-turn continuity even though the CI runner is ephemeral:

1. **Before the run**: the archived transcript from `state/sessions/` is copied into the OpenClaw runtime directory so the agent can locate it by session ID.
2. **After the run**: the updated transcript is copied back to `state/sessions/` where it is committed to git and survives runner teardown.

---

## Command Policy Enforcement

A machine-readable command policy at `.GITOPENCLAW/config/command-policy.json` provides additional guardrails:

```json
{
  "enforcement": "enforce",
  "allowedCommands": ["help", "status", "doctor", "config", "configure",
    "channels", "sessions", "memory", "models", "cron", "plugins",
    "skills", "update", "agent", "health", "onboard", "nodes"],
  "blockedPatterns": ["deploy", "publish", "release", "delete", "rm -rf"],
  "requirePrefixForActions": false,
  "actionPrefix": "/openclaw"
}
```

- Commands not in `allowedCommands` are rejected with an error message.
- The raw text is scanned for `blockedPatterns` (substring match); if found, a warning is posted and the command is not executed.
- If `requirePrefixForActions` is `true`, only comments starting with the `actionPrefix` (e.g., `/openclaw status`) are processed.

---

## Cost and Resource Boundaries

Every agent run is bounded by the limits in `config/settings.json`:

```json
{
  "limits": {
    "maxTokensPerRun": 100000,
    "maxToolCallsPerRun": 50,
    "workflowTimeoutMinutes": 10
  }
}
```

- **`workflowTimeoutMinutes`** is enforced as the GitHub Actions job `timeout-minutes` and via the `openclaw agent --timeout` flag.
- **`maxTokensPerRun`** and **`maxToolCallsPerRun`** are enforced post-run by parsing the `--json` output. If limits are exceeded, a budget violation is logged to `.GITOPENCLAW/state/usage.log` and an optional warning comment is posted.

---

## Summary

First Light means: **drop a folder, push, open an issue, talk to your agent**. Every OpenClaw CLI command is available through Issue comments ‚Äî either as natural language or structured `/slash` commands. The security pipeline validates configuration, enforces trust levels, and applies cost boundaries before any command executes. Replies are rich Markdown posted as Issue comments. All state is committed to git for full auditability. No servers, no infrastructure, no accounts to create ‚Äî just GitHub.
